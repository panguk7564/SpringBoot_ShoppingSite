<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>장바구니</title>
    <style>
        footer {
            background-color: #006bff;
            padding: 10px;
            color: #fff;
            position: fixed;
            left: 0;
            bottom: 0;
            width: 100%;
            text-align: center;
        }

        table {
            border: 1px solid black;
            border-collapse: collapse;
        }

        th, td {
            border: 1px solid black;
            padding: 10px;
        }
    </style>
</head>
<body>
<table>
    <tr th:each="cart: ${cartList}">
        <td th:text="${cart.getId}"></td>
        <td><a th:text="${cart.getCartedName()}"></a></td>
        <td th:text="${cart.getPrice}"></td>
        <td th:text="${cart.getItem_Quantity}"></td>
        <td>
            <a th:href="@{'/mem/cart/delete/' + ${cart.getId}}">삭제</a>
        </td>
    </tr>
</table>

<button onclick="goBack()">뒤로가기</button>
<button onclick="sendData()">구매하기</button>

<script>
    function goBack() {
        window.history.back();
    }

   function sendData() {
        const confirmation = confirm("주문하시겠습니까?");
        if (confirmation) {
            var cartListData = [];
            var rows = document.querySelectorAll('table tr');
            for (var i = 0; i < rows.length; i++) {
                var row = rows[i];
                var id = row.cells[0].textContent;
                var quantity = row.cells[3].textContent;

                var cartData = {
                    "id": id,
                    "quantity": quantity,
                };

                cartListData.push(cartData);
            }

            var jsonData = JSON.stringify(cartListData);

            fetch('/payindex', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: jsonData
            })
            .then(response => {
                if (response.ok) {
                    console.log("주문이 성공적으로 전송되었습니다.");
                    window.location.href = "/payindex";
                } else {
                    console.log("주문 전송에 실패했습니다.");
                }
            })
            .catch(error => {
                console.error("주문 전송 중 오류가 발생했습니다:", error);
            });
        } else {
            console.log("주문이 취소되었습니다.");
        }
    }
</script>

</body>
</html>
